import win32com.client
import os

# Function to extract unread emails
def extract_unread_emails():
    try:
        # Connect to Outlook
        outlook = win32com.client.Dispatch("Outlook.Application")
        mapi = outlook.GetNamespace("MAPI")

        # Access the inbox
        inbox = mapi.GetDefaultFolder(6)  # 6 refers to the inbox folder
        messages = inbox.Items
        messages = messages.Restrict("[Unread] = true")

        # Folder to save email contents
        save_folder = "unread_emails"
        if not os.path.exists(save_folder):
            os.makedirs(save_folder)

        # Iterate through unread emails
        for message in messages:
            subject = message.Subject
            sender = message.SenderName
            received_time = message.ReceivedTime
            body = message.Body
            html_body = message.HTMLBody

            # Print email details
            print(f"Subject: {subject}")
            print(f"Sender: {sender}")
            print(f"Received: {received_time}")
            print(f"Body: {body}")
            print(f"HTML Body: {html_body}")

            # Save email details to a file
            file_path = os.path.join(save_folder, f"{subject}.txt")
            with open(file_path, "w", encoding="utf-8") as file:
                file.write(f"Subject: {subject}\n")
                file.write(f"Sender: {sender}\n")
                file.write(f"Received: {received_time}\n")
                file.write(f"Body: {body}\n")
                file.write(f"HTML Body: {html_body}\n")

            # Mark email as read
            message.Unread = False

    except Exception as e:
        print(f"Error: {e}")

# Extract unread emails
extract_unread_emails()